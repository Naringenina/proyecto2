{% extends "base.html" %}
{% block title %}Import Â· Cards Inventory{% endblock %}
{% block content %}

<h1 class="text-2xl font-bold mb-4">Import CSV</h1>

<p class="mb-4 text-sm text-gray-600">
  The CSV must include at least: <code>name, game, set_name, number_set, rarity, condition, language</code>.
  Optional: <code>set_code, quantity, location, comercial_condition, variant, notes, tags</code>.
</p>

<div class="mb-4 flex gap-2">
  <a class="px-3 py-2 bg-gray-800 text-white rounded" href="{{ request.url_for('export_sample_csv') }}">Download sample CSV</a>
</div>

{% if err %}
  <div class="mb-3 p-2 bg-red-50 border border-red-300 text-red-800 rounded">{{ err }}</div>
{% endif %}

<form method="post" action="{{ request.url_for('import_csv') }}" enctype="multipart/form-data" class="space-y-3">
  <div>
    <label class="block text-sm text-gray-600 mb-1">CSV file</label>
    <input type="file" name="file" accept=".csv,text/csv" required class="border rounded px-3 py-2">
  </div>

  <div>
    <label class="block text-sm text-gray-600 mb-1">Duplicate policy</label>
    <select name="dup_policy" class="border rounded px-3 py-2">
      <option value="merge">merge (add to quantity)</option>
      <option value="skip">skip</option>
      <option value="replace">replace</option>
    </select>
  </div>

  <div class="flex items-center gap-2">
    <input id="cm" type="checkbox" name="create_missing_tags" value="true" checked />
    <label for="cm" class="text-sm text-gray-700">Create missing tags</label>
  </div>

  <button class="px-4 py-2 bg-blue-600 text-white rounded-lg">Import</button>
</form>

{% if result %}
  <div class="mt-6 bg-white border rounded p-4">
    <h2 class="font-semibold mb-2">Result</h2>
    <ul class="list-disc list-inside text-sm">
      <li>Created: {{ result.created }}</li>
      <li>Updated: {{ result.updated }}</li>
      <li>Skipped: {{ result.skipped }}</li>
      <li>Detected delimiter: <code>{{ result.delimiter }}</code></li>
      <li>Total rows processed: {{ result.total_rows }}</li>
    </ul>

    {% if result.errors and result.errors|length %}
      <div class="mt-3 p-2 bg-yellow-50 border border-yellow-300 text-yellow-800 rounded">
        <div class="font-medium mb-1">Warnings/errors</div>
        <ul class="list-disc list-inside">
          {% for e in result.errors %}
            <li class="text-sm">{{ e }}</li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  </div>
{% endif %}

{% endblock %}
